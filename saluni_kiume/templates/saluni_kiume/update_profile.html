{% extends "base.html" %}

{% block content %}
<section class="update-section">
    <div class="container">
        <div class="update-card">
            <h2>Endelea na Taarifa za Saluni</h2>

            {# Success messages #}
            {% if messages %}
                {% for message in messages %}
                    <div class="success-message">{{ message }}</div>
                {% endfor %}
            {% endif %}

            {# Form error summary #}
            {% if form.errors %}
                <div class="error-message">
                    Tafadhali hakikisha umejaza taarifa zako kwa usahihi.
                </div>
            {% endif %}

            <form method="post" id="salon-form">
                {% csrf_token %}

                {% for field in form %}
                    {% if field.name != "latitude" and field.name != "longitude" %}
                        <div class="form-group">
                            {{ field.label_tag }}
                            {{ field }}
                            {% if field.errors %}
                                <p class="field-error">{{ field.errors|striptags }}</p>
                            {% endif %}
                        </div>
                    {% else %}
                        {{ field }} {# Hidden fields #}
                    {% endif %}
                {% endfor %}

                <button type="submit" class="btn-submit">Hifadhi</button>
                <a href="{% url 'kiume:male_salon_detail' salon.id %}" class="btn-cancel">Rudi</a>
            </form>
        </div>
    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById('salon-form');

    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((position) => {
            const latField = document.getElementById("id_latitude");
            const lngField = document.getElementById("id_longitude");
            if (latField && lngField) {
                // Round coordinates to 6 decimal places to match model validation
                latField.value = parseFloat(position.coords.latitude.toFixed(6));
                lngField.value = parseFloat(position.coords.longitude.toFixed(6));
            }
        });
    }
});
</script>

<style>
body { font-family: 'Poppins', sans-serif; background:#f0f4f8; }
.container { max-width:600px; margin:50px auto; padding:20px; }
.update-card { background:#fff; padding:30px; border-radius:15px; box-shadow:0 8px 25px rgba(0,0,0,0.12); }
h2 { text-align:center; color:#4b6cb7; margin-bottom:20px; }
.form-group { margin-bottom:15px; }
input, select, textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; font-size:0.95rem; }
.btn-submit { width:100%; padding:12px; background:#4b6cb7; color:#fff; font-weight:bold; border:none; border-radius:10px; cursor:pointer; margin-top:10px; }
.btn-submit:hover { background:#3f51b5; }
.btn-cancel { display:block; width:100%; text-align:center; padding:10px; margin-top:10px; color:#4b6cb7; text-decoration:none; font-weight:bold; border:1px solid #4b6cb7; border-radius:10px; }
.btn-cancel:hover { background:#4b6cb7; color:#fff; }
.field-error { color:#c2185b; font-size:0.85rem; margin-top:5px; }
.error-message { color:#c2185b; font-weight:600; margin-bottom:15px; text-align:center; }
.success-message { color:#2e7d32; font-weight:600; margin-bottom:15px; text-align:center; }
</style>
{% endblock %}
